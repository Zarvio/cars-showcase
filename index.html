<!doctype html>
<html lang="hi">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Show → Join TG → Key</title>
<link rel="stylesheet" href="style.css">


</head>
<body>
<header>
  Welcome to Feature Mod Keys
</header>

<div class="card">
  <img src="tg.jpg" class="circle-img" alt="Logo">
  <h2>Get Your Key</h2>
  <p class="muted">Process: Show → Join Telegram → Key</p>

  <!-- User Steps -->
  <div id="step-show">
    <button id="btnShow">Show Key</button>
  </div>
  <div id="step-join" class="hidden">
    <button id="btnJoin">Join Telegram</button>
  </div>
  <div id="step-key" class="hidden">
    <h3>Your Key:</h3>
    <div style="display:flex; gap:8px; align-items:center; justify-content:center;">
      <pre id="keyBox">—</pre>
      <button id="btnCopy">Copy</button>
    </div>
    <div id="copyMsg" class="small" style="color:#16a34a; display:none;">Key copied ✓</div>
  </div>

  <!-- Admin -->
  <div id="admin-panel" style="display:none; margin-top:20px;">
    <button id="btnAdminLogin">Admin Login</button>
    <div id="adminPassSection" class="hidden" style="margin-top:10px;">
      <input id="adminPassInput" type="password" placeholder="Enter Admin Password">
      <button id="btnSubmitPass">Submit</button>
      <p id="adminMsg" class="error"></p>
    </div>
    <div id="adminKeySection" class="hidden" style="margin-top:10px;">
      <input id="adminKeyInput" type="text" placeholder="Add Key for users">
      <button id="btnAddKey">Add Key</button>
      <p id="adminKeyMsg" class="small" style="color:#16a34a;"></p>
    </div>
  </div>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

<script>
// Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyDUefeJbHKIAs-l3zvFlGaas6VD63vv4kI",
  authDomain: "inspire4ever-c60ad.firebaseapp.com",
  databaseURL: "https://inspire4ever-c60ad-default-rtdb.firebaseio.com",
  projectId: "inspire4ever-c60ad",
  storageBucket: "inspire4ever-c60ad.appspot.com",
  messagingSenderId: "125014633127",
  appId: "1:125014633127:web:d29e4c37628ab637f40982"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// Elements
const TELEGRAM_INVITE = 'https://t.me/+eT13u4rIiBwwY2U9';
const btnShow = document.getElementById('btnShow');
const stepShow = document.getElementById('step-show');
const stepJoin = document.getElementById('step-join');
const stepKey = document.getElementById('step-key');
const btnJoin = document.getElementById('btnJoin');
const keyBox = document.getElementById('keyBox');
const btnCopy = document.getElementById('btnCopy');
const copyMsg = document.getElementById('copyMsg');

// Admin Elements
const adminPanel = document.getElementById('admin-panel');
const btnAdminLogin = document.getElementById('btnAdminLogin');
const adminPassSection = document.getElementById('adminPassSection');
const adminPassInput = document.getElementById('adminPassInput');
const btnSubmitPass = document.getElementById('btnSubmitPass');
const adminMsg = document.getElementById('adminMsg');
const adminKeySection = document.getElementById('adminKeySection');
const adminKeyInput = document.getElementById('adminKeyInput');
const btnAddKey = document.getElementById('btnAddKey');
const adminKeyMsg = document.getElementById('adminKeyMsg');
const DEMO_ADMIN_PASSWORD = 'admin123';

let tgWindow = null;
let pollTimer = null;
let startTime = null;
let revealed = false;

// ---------------- User Logic ----------------
function fetchKey() {
  db.ref('keys/latest').once('value')
    .then(snapshot => {
      const key = snapshot.val() || '—';
      keyBox.textContent = key;
    })
    .catch(err => console.error(err));
}
db.ref('keys/latest').on('value', snapshot => {
  const key = snapshot.val() || '—';
  keyBox.textContent = key;
});

btnShow.addEventListener('click', () => {
  stepShow.classList.add('hidden');
  stepJoin.classList.remove('hidden');
  startTime = Date.now();
  fetchKey();
});

btnJoin.addEventListener('click', () => {
  try { tgWindow = window.open(TELEGRAM_INVITE, '_blank'); } catch(e){ tgWindow=null; }
  startTime = Date.now();
  revealed=false;
  pollTimer=setInterval(()=>{
    if(tgWindow && tgWindow.closed){ reveal(); }
    if(document.hasFocus() && Date.now()-startTime>500){ reveal(); }
  },500);
});

function reveal(){
  if(revealed) return;
  revealed=true;
  clearInterval(pollTimer);
  stepJoin.classList.add('hidden');
  stepKey.classList.remove('hidden');
}

// Copy
async function copyTextToClipboard(text){
  if(navigator.clipboard && navigator.clipboard.writeText){
    try{ await navigator.clipboard.writeText(text); return true;}catch(e){}
  }
  try{
    const ta=document.createElement('textarea');
    ta.value=text;
    ta.style.position='fixed';
    ta.style.top='-9999px';
    document.body.appendChild(ta);
    ta.focus(); ta.select();
    const ok=document.execCommand('copy');
    document.body.removeChild(ta);
    return ok;
  }catch(e){ return false; }
}
btnCopy.addEventListener('click', async()=>{
  const text=keyBox.textContent.trim();
  if(!text || text==='—') return;
  const ok=await copyTextToClipboard(text);
  if(ok){ copyMsg.style.display='block'; setTimeout(()=>{ copyMsg.style.display='none';},2000);}
});

// Focus & visibility
window.addEventListener('focus',()=>{ if(!revealed && startTime && Date.now()-startTime>500) reveal(); });
document.addEventListener('visibilitychange',()=>{ if(document.visibilityState==='visible' && !revealed && startTime && Date.now()-startTime>500) reveal(); });

// ---------------- Admin Logic ----------------
adminPanel.style.display='none';
adminPassSection.classList.add('hidden');
adminKeySection.classList.add('hidden');

let tapCount=0;
let tapTimer;
document.querySelector('.circle-img').addEventListener('click', ()=>{
  tapCount++;
  clearTimeout(tapTimer);
  tapTimer=setTimeout(()=>{ tapCount=0; },1000);
  if(tapCount>=5){
    adminPanel.style.display='block';
    adminPassSection.classList.add('hidden');
    adminKeySection.classList.add('hidden');
    tapCount=0;
  }
});

// Show password input
btnAdminLogin.addEventListener('click', ()=>{
  adminPassSection.classList.remove('hidden');
  adminMsg.textContent='';
  adminPassInput.value='';
});

// Check password
btnSubmitPass.addEventListener('click', ()=>{
  const password = adminPassInput.value.trim();
  if(password===DEMO_ADMIN_PASSWORD){
    adminKeySection.classList.remove('hidden');
    adminMsg.textContent='Logged in! Add key below.';
    adminMsg.style.color='#16a34a';
    adminPassSection.classList.add('hidden');
  } else {
    adminMsg.textContent='Incorrect password!';
    adminMsg.style.color='#dc2626';
  }
});

// Add key
btnAddKey.addEventListener('click', ()=>{
  const newKey = adminKeyInput.value.trim();
  if(!newKey) return;
  db.ref('keys/latest').set(newKey)
    .then(()=>{
      adminKeyMsg.textContent='Key updated successfully!';
      adminKeyInput.value='';
    })
    .catch(err=>{
      adminKeyMsg.textContent='Error saving key!';
      console.error(err);
    });
});
</script>
</body>
</html>
